# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This repository uses [JSON Type Definition (RFC8927)](https://jsontypedef.com/) to model JSON responses from the Senzing SDK. The core specification file (`senzingsdk-RFC8927.json`) is used to generate strongly-typed code for multiple languages, enabling IDE code-completion and compile-time type checking.

**Important:** Code in the language-specific directories (`go/typedef/`, `python/senzing_typedef/`, `java/`, `csharp/`, `typescript/`, `ruby/`, `rust/`) is **auto-generated** and should not be manually edited. Always modify `senzingsdk-RFC8927.json` and regenerate.

## Common Commands

```bash
# Setup development environment (one-time)
make dependencies-for-development

# Regenerate code for all languages after modifying senzingsdk-RFC8927.json
make generate

# Run linting (includes RFC8927 analysis, pylint, golangci-lint, cspell)
make lint

# Run all tests (Go, Python, Java, C#, TypeScript)
make test

# Run specific language tests
make test-go
make test-python
make test-java
make test-csharp

# Clean, setup database, generate code, and generate documentation
make version

# Generate test data from truthsets
make testdata-responses-truthsets

# Python virtual environment activation
source .venv/bin/activate
```

## Architecture

### Code Generation Flow

1. Edit `senzingsdk-RFC8927.json` (the single source of truth)
2. Run `make generate` to regenerate code via `jtd-codegen`
3. CI (`test-generated-files.yaml`) verifies generated code matches the spec

### Key Directories

- `senzingsdk-RFC8927.json` - Core JSON Type Definition specification
- `bin/` - Python utility scripts for testing, analysis, and documentation generation
- `testdata/` - Test data organized by source:
  - `responses/` - Generated from live Senzing SDK calls
  - `responses_truthsets/` - Generated from truth set data
  - `responses_static/` - Static test fixtures
  - `truthsets/` - Downloaded truth set data files

### Python Package

The Python package (`senzing-typedef`) is in `python/senzing_typedef/`. Dependencies and dev groups are defined in `pyproject.toml`.

### Go Module

Go code lives in `go/typedef/`. The `generated_typedef_test.go` file is auto-generated by `bin/make_go_typedef_generated_typedef_test_go.py`.

## Linting Requirements

Running `make lint` performs several RFC8927 spec validations:

- JSON keys must be in sorted order
- No duplicate JSON key definitions
- All `ref` values must be valid
- Reports unused JSON keys

If there's a diff between `senzingsdk-RFC8927.json` and the temporary `senzingsdk-RFC8927-pretty.json`, fix the formatting in the original file.

## Prerequisites

Required tools for development:

- `jtd-codegen` - JSON Type Definition code generator
- Go 1.24+
- Python 3.10+
- Make
- Docker (for some operations)

The Senzing SDK must be installed at `/opt/senzing/er/lib` for tests that require it.
